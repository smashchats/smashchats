DROP VIEW `chat_list_view`;--> statement-breakpoint
CREATE VIEW `chat_list_view` AS select "contacts"."did_id", "contacts"."meta_title", "contacts"."meta_picture", "contacts"."smashed", "messages"."data", "messages"."type", "trust_relations"."name", "contacts"."created_at", MAX("messages"."created_at") as "most_recent_message_date", COUNT("messages"."sha256") - COUNT("messages"."date_read") as "unread_count" from "contacts" left join "messages" on "contacts"."did_id" = "messages"."discussion_id" left join "trust_relations" on "contacts"."did_id" = "trust_relations"."did_id" group by "contacts"."did_id" order by "messages"."created_at" desc;